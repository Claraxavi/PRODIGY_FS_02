<!DOCTYPE html>
<html>
<head>
    <title>Employee Management</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="header">
    <h2>Employee Management</h2>
    <button class="logout-btn" onclick="logout()">Logout</button>
</div>

<div class="main">

<form id="employeeForm">
    <input type="text" id="name" placeholder="Name" required>
    <input type="email" id="email" placeholder="Email" required>
    <input type="text" id="position" placeholder="Position" required>
    <input type="number" id="salary" placeholder="Salary" required>
    <button type="submit">Add Employee</button>
</form>

<h3 id="employeeCount">Total Employees: 0</h3>

<input type="text" id="searchInput" placeholder="Search by name..."
       style="width:300px; padding:8px; margin-bottom:15px;">

<table id="employeeTable">
    <thead>
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Email</th>
            <th>Position</th>
            <th>Salary</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

</div>

<script>

const token = localStorage.getItem("token");

if (!token) {
    alert("Please login first");
    window.location.href = "login.html";
}

const tableBody = document.querySelector("#employeeTable tbody");
const form = document.getElementById("employeeForm");
const searchInput = document.getElementById("searchInput");

let editId = null;
let employeesData = [];

// Load employees
async function loadEmployees() {
    const res = await fetch("http://localhost:5000/api/employees", {
        headers: {
            "Authorization": "Bearer " + token
        }
    });

    employeesData = await res.json();

    document.getElementById("employeeCount").innerText =
        "Total Employees: " + employeesData.length;

    renderTable(employeesData);
}

// Render table
function renderTable(data) {
    tableBody.innerHTML = "";

    data.forEach(emp => {
        const row = `
            <tr>
                <td>${emp.id}</td>
                <td>${emp.name}</td>
                <td>${emp.email}</td>
                <td>${emp.position}</td>
                <td>${emp.salary}</td>
                <td>
                    <button class="edit-btn"
                        onclick="editEmployee(${emp.id}, '${emp.name}', '${emp.email}', '${emp.position}', ${emp.salary})">
                        Edit
                    </button>
                    <button class="delete-btn"
                        onclick="deleteEmployee(${emp.id})">
                        Delete
                    </button>
                </td>
            </tr>
        `;
        tableBody.innerHTML += row;
    });
}

// Search functionality
searchInput.addEventListener("input", function () {
    const value = this.value.toLowerCase();

    const filtered = employeesData.filter(emp =>
        emp.name.toLowerCase().includes(value)
    );

    renderTable(filtered);
});

// Add or Update employee
form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const employee = {
        name: document.getElementById("name").value,
        email: document.getElementById("email").value,
        position: document.getElementById("position").value,
        salary: document.getElementById("salary").value
    };

    if (editId) {
        await fetch("http://localhost:5000/api/employees/" + editId, {
            method: "PUT",
            headers: {
                "Content-Type": "application/json",
                "Authorization": "Bearer " + token
            },
            body: JSON.stringify(employee)
        });

        editId = null;
        form.querySelector("button").textContent = "Add Employee";

    } else {
        await fetch("http://localhost:5000/api/employees", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": "Bearer " + token
            },
            body: JSON.stringify(employee)
        });
    }

    form.reset();
    loadEmployees();
});

// Fill form for editing
function editEmployee(id, name, email, position, salary) {
    document.getElementById("name").value = name;
    document.getElementById("email").value = email;
    document.getElementById("position").value = position;
    document.getElementById("salary").value = salary;

    editId = id;
    form.querySelector("button").textContent = "Update Employee";
}

// Delete employee
async function deleteEmployee(id) {

    const confirmDelete = confirm("Are you sure you want to delete this employee?");

    if (!confirmDelete) return;

    await fetch("http://localhost:5000/api/employees/" + id, {
        method: "DELETE",
        headers: {
            "Authorization": "Bearer " + token
        }
    });

    loadEmployees();
}

// Logout
function logout() {
    localStorage.removeItem("token");
    window.location.href = "login.html";
}

// Initial load
loadEmployees();

</script>

</body>
</html>